import React, {useState, useContext, createRef}  from "react";
import { authContext } from "../App";


export const Upload = () => {
  
  const { state: authState  } = useContext(authContext);
  const id = authState.user._id;

  const [file, setFile] = useState(); 

  const handleChange = event =>  setFile( event.target.files[0] )

  const  handleSubmit = event => {
  event.preventDefault();

  const formData = new FormData();
  formData.append('avatar', file)

  fetch(`http://localhost:5000/api/user/${id}`, { 
    method: 'PUT',
    headers: { 
              Authorization: `Bearer ${authState.token}`           
        },
    body: file ,
  }).then(
    response => response.json() // if the response is a JSON object
  ).then(
    success => console.log(success) // Handle the success response object
  ).catch(
    error => console.log(error) // Handle the error response object
  );
};

console.log("file", file);
   
    return(
      <form onSubmit={handleSubmit} encType="multipart/form-data" >
        <label>
          Upload file:
          <input type="file" name='avatar'  onChange={handleChange}></input> 
        </label>
        <br />
        <button type="submit">Submit</button>
      </form>
    );
}


export default Upload ;







function  handleSubmit(img,id,authState) {
  console.log("submit")
  const formData = new FormData();
  formData.append('avatar', img)
  fetch(`http://localhost:5000/api/user/${id}`, { 
  method: 'PUT',
  headers: { 
            Authorization: `Bearer ${authState.token}`           
      },
  body: img ,
}).then(
  response => response.json() // if the response is a JSON object
).then(
  success => console.log(success) // Handle the success response object
).catch(
  error => console.log(error) // Handle the error response object
);
}